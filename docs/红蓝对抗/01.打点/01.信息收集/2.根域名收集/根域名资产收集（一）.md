通常情况下本脚本小子拿到的授权书要不是公司名字要不是一个主域名，那么可以通过下面的技巧扩展外网的根域名暴露面，提高接入目标内网的概率。

# 1. 利用ICP备案信息进行收集

在中华人民共和国境内提供非经营性互联网信息服务，应当依法履行备案手续。未经备案，不得在中华人民共和国境内从事经营性互联网信息服务。目前只要是企业在中国境内需要提供互联网服务，都必须通过ICP工商备案才能运行。（未备案的或者在备案路上的后面再讲）我们可以通过 [信息备案管理系统](https://beian.miit.gov.cn) 进行查询。

![image-20220627174848448](https://cdn.jsdelivr.net/gh/R1card0-tutu/R1card0-tutu@main/img/202206271748685.png)

输入框支持反向查询。ICP备案查询：请输入单位名称或域名或备案号查询，请勿使用子域名或者带`http://www`等字符的网址查询

# 2.工商股权信息收集

从暴露面风险上来说企业在被收购或者控股后在IT架构上也会接入集团的IT网络中，相关的业务也会有比较紧密的合作，所有一旦子公司存在比较严重的安全风险，攻击者可将子公司的网络作为跳板进一步的公司集团核心业务系统。获取到子公司的名称后我们再通过利用ICP备案信息进行收集中的ICP备案信息查询获取到公司备案的其他根域名信息。
目前国内所有的企业，无论是私营企业还是国有企业都需要进行工商登记后才能进行企业正常运营。可以通过 [国家企业信用信息公示系统](http://www.gsxt.gov.cn/index.html) 查询指定企业的工商注册信息。以及通过商业公司：天眼查、企查查、爱企查、小蓝本、钉钉企典、EnScan等平台查询到目标企业旗下其他业务的子公司名称，通过子公司的ICP备案信息再进一步扩展其他的根域名数据。

![image-20220627181846716](https://cdn.jsdelivr.net/gh/R1card0-tutu/R1card0-tutu@main/img/202206271818962.png)

 一般来说我们定义控股或者并购关系的公司一般都属于目标企业的所属集团，当然有些并购可能不对外公式，我们可以关注一些投融资的新闻来获取这部分讯息。

# 3. Whois数据信息收集

前面两步我们已经获取到企业在境内备案的根域名数据，但是在实际的入侵过程中往往会遇到企业分公司未经审计私开业务、企业非备案的境外业务等情况。每个域名的注册都必须对外公开Whois数据，但是现在很多域名商默认都会开启域名隐私保护，需要借助一些数据平台查询域名历史的Whois信息来进行关联。通过[Whois网站](http://whois.chinaz.com/) 查询 

1. 利用ICP备案信息进行收集到的根域名

2. 工商股权信息收集收集到的根域名

查询历史注册者和注册邮箱，扩展更多的关联资产。

# 4. SSL证书扩展

前面的步骤目前收集到大量的根域名信息，但是还是有一些域名它没有工商备案信息，域名也是新注册的开启了隐私保护从Whois历史数据中也没办法找到关联方法。可以借助资产探测平台来寻找一些域名关联的特征。企业在申请证书的时候一般会将同类业务域名的申请成一张成熟，一方面是出于成本考虑，还有一方面也是方面对证书进行同一的管理。

```
cert=""
```

![image-20220627184831863](https://cdn.jsdelivr.net/gh/R1card0-tutu/R1card0-tutu@main/img/202206271848011.png)

![image-20220627184928427](https://cdn.jsdelivr.net/gh/R1card0-tutu/R1card0-tutu@main/img/202206271849491.png)

在证书里面发现的其他与目标强相关的关键词也可以再次查询。

# 5. DNS解析数据关联

一般大型的企业会自建DNS服务器用于业务域名的解析，一般情况只会对自有业务提供DNS解析服务。

```
nslookup -type=ns domain
dig -t ns domain
```

将查询到的ns域名作为key，通过公开的DNS解析数据集rapid7 [DNS](https://opendata.rapid7.com/) 搭建DNSDB或者使用公开的数据集合

```
https://hackertarget.com/find-shared-dns-servers/ 
https://github.com/spyse-com/go-spyse
```

![image-20220627203414909](https://cdn.jsdelivr.net/gh/R1card0-tutu/R1card0-tutu@main/img/202206272034131.png)反向查询ns服务器对应的根域名数据。查询到的数据需要进行进一步的筛选和验证。

# 6. Web配置信息关联

- 响应头的CSP中定义允许跨域资源加载的白名单地址
- Set-Cookie中定义Cookie适用的可用域范围
- Set-Cookie的特殊标记
- Server自定义业务名称
- 自定义的ICON图标（mmh3 hash）
- ICP备案号
- 在线的运营工具(百度统计、53客服、扫描登录等)
- 百度统计的hash
- 美洽客服