# 0x01 子域名收集流程

![img](https://cdn.jsdelivr.net/gh/R1card0-tutu/R1card0-tutu@main/img/202206291448060.png)

# 0x02 通过第三方数据源收集

比较有名有VirusTotal、微步、SecurityTrails、Spyse、Censys等。

![img](https://huoxian-community.oss-cn-beijing.aliyuncs.com/2021-07-12/1edcb8afc7e68dec55fc9a6c55679080)

参考：https://gist.github.com/sidxparab/22c54fd0b64492b6ae3224db8c706228

# 0x03 子域名爆破

字典：https://raw.githubusercontent.com/joinsec/BadDNS/master/domaindict-170W.txt

优质的DNS服务ip：https://raw.githubusercontent.com/bp0lr/dmut-resolvers/main/resolvers.txt

爆破工具：https://github.com/d3mondev/puredns

## 安装部署

go环境

```
wget https://go.dev/dl/go1.17.11.linux-amd64.tar.gz
tar -C /usr/local -xzf go1.17.11.linux-amd64.tar.gz
export PATH=$PATH:/usr/local/go/bin    （添加到/etc/profile）
source /etc/profile
```

massdns环境

```
git clone https://github.com/blechschmidt/massdns.git
cd massdns
make
sudo make install
```

安装puredns

```
go env -w GOPROXY=https://goproxy.cn
go install github.com/d3mondev/puredns/v2@latest
git clone https://github.com/d3mondev/puredns.git
make
```

运行常用命令

```
puredns bruteforce ./domaindict-170W.txt domain.com --resolvers resolvers.txt
```

# 0x04 排列组合

在我们渗透过程中，总是会发现一些子域名带有以下关键词

```
admin
alpha
api
backend
beta
dev
intra
prod
staging
staging
test
uat
```

以sso.huoxian.cn举例子，可能会有如下命名方式的子域名

```
sso-test.huoxian.cn
sso.test.huoxian.cn
ssotest.huoxian.cn
testsso.huoxian.cn
```

我们可以通过dnsgen这款工具生成子域名列表，再进行解析，来扩大攻击面。

```
echo 'sso.huoxian.cn' |  dnsgen -w alt.txt - 
```

![image-20220629144126663](https://cdn.jsdelivr.net/gh/R1card0-tutu/R1card0-tutu@main/img/202206291441992.png)