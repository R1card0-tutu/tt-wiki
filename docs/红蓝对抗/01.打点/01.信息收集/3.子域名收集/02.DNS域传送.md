# 0x01 DNS域传送漏洞简介

DNS服务器分为主服务器，备份服务器，缓存服务器。

**域传送**是指备份服务器从主服务器上复制数据，然后更新自身的数据库，以达到数据同步的目的，这样是为了增加冗余，一旦主服务器出现问题可直接让备份服务器做好支撑工作。

而**域传送漏洞**则是由于DNS配置不当，导致匿名用户可以获取某个域的所有记录，造成整个网络的拓扑结构泄露给潜在的攻击者，凭借这份网络蓝图，攻击者可以节省大量的扫描时间，同时提升了目标的准确度。

# 0x02 检测方法

## nslookup

```
# 查询nameserver
nslookup -type=ns knownsec.com 119.29.29.29
# 指定nameserver，列举域名信息
nslookup
    server dns29.hichina.com
    ls knownsec.com
```

![image-20220629153359352](https://cdn.jsdelivr.net/gh/R1card0-tutu/R1card0-tutu@main/img/202206291533699.png)

## dig

`axfr` 是q-type类型的一种，axfr类型是`Authoritative Transfer`的缩写，指请求传送某个区域的全部记录。

我们只要欺骗dns服务器发送一个`axfr`请求过去，如果该dns服务器上存在该漏洞，就会返回所有的解析记录值

```
# 找到NS服务器
dig knownsec.com ns
# 发送axfr请求
dig axfr @f1g1ns2.dnspod.net knownsec.com
```

![image-20220629154235637](https://cdn.jsdelivr.net/gh/R1card0-tutu/R1card0-tutu@main/img/202206291542940.png)

## nmap

nmap的脚本`dns-zone-transfer`可以帮我们探测是否存在域传送漏洞

```bash
nmap --script dns-zone-transfer --script-args dns-zone-transfer.domain=knownsec.com -p 53 -Pn f1g1ns1.dnspod.net
```